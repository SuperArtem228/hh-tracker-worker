# HH Tracker (Cloudflare Worker + D1)

Telegram-–±–æ—Ç –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ –æ—Ç–∫–ª–∏–∫–æ–≤ –∏–∑ hh.ru.

## –ß—Ç–æ —É–º–µ–µ—Ç —Å–µ–π—á–∞—Å

- **–ú—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º**: –æ–¥–∏–Ω Telegram user_id = –æ–¥–Ω–∞ ‚Äú—É—á—ë—Ç–∫–∞‚Äù (–¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è).
- –ö–æ–ø–∏–ø–∞—Å—Ç–∞ –∏–∑ hh.ru ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ D1 (SQLite).
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–º** –∑–∞ –ø–µ—Ä–∏–æ–¥.
- **–û—Ç—á—ë—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏** (–∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ Telegram).
- **CSV –≤—ã–≥—Ä—É–∑–∫–∞** (—Ñ–∞–π–ª –ø—Ä—è–º–æ –≤ —á–∞—Ç).
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: **–æ–±—â–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Google Sheet** (–æ–¥–Ω–∞ –¥–ª—è –≤—Å–µ—Ö) —á–µ—Ä–µ–∑ `SHEET_URL`.
- **–†—É—á–Ω–æ–π –≤–≤–æ–¥ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π** (—Å–∫—Ä–∏–Ω–∏–Ω–≥ / HR / —Ç–µ—Ö–Ω–∏—á–∫–∞ / –æ—Ñ—Ñ–µ—Ä) ‚Äî —á—Ç–æ–±—ã –≤–æ—Ä–æ–Ω–∫–∞ –±—ã–ª–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ –æ—Ç–∫–ª–∏–∫–∞–º, –Ω–æ –∏ –ø–æ —Å–æ–±–µ—Å–∞–º.

## –ë—ç–∫–ª–æ–≥

1) **–†—É—á–Ω–æ–π –≤–≤–æ–¥ —ç—Ç–∞–ø–æ–≤ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π –∏ ‚Äú–ø–æ–ª–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞‚Äù**

–Æ–∑–∫–µ–π—Å: –≤ –ø—è—Ç–Ω–∏—Ü—É –≤–µ—á–µ—Ä–æ–º —é–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞, –∫–æ–ø–∏–ø–∞—Å—Ç–∏—Ç hh.ru –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∫–æ–ª-–≤–æ —Å–æ–±–µ—Å–æ–≤ (—Å–∫—Ä–∏–Ω–∏–Ω–≥ / HR / —Ç–µ—Ö–Ω–∏—á–∫–∞ / –æ—Ñ—Ñ–µ—Ä). –ë–æ—Ç —Å—Ç—Ä–æ–∏—Ç –æ–±—â—É—é –≤–æ—Ä–æ–Ω–∫—É: –æ—Ç–∫–ª–∏–∫–∏ + —Å–æ–±–µ—Å—ã.

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **–∫–Ω–æ–ø–∫–∞–º–∏** (–º–µ–Ω—é) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±. –ö–æ–º–∞–Ω–¥—ã —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç.

–ö–æ–º–∞–Ω–¥—ã:
- `/start` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é
- `/new` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä
- (–≤—Å—Ç–∞–≤–ª—è–µ—à—å —Ç–µ–∫—Å—Ç –∏–∑ hh.ru)
- `/done` ‚Äî —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
- `/interviews` ‚Äî —Ä—É–∫–∞–º–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (—Å–∫—Ä–∏–Ω–∏–Ω–≥/HR/—Ç–µ—Ö–Ω–∏—á–∫–∞/–æ—Ñ—Ñ–µ—Ä)
- `/stats [week|month|all]` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/report [week|month|all]` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ + –≥—Ä–∞—Ñ–∏–∫–∏
- `/export [week|month|all]` ‚Äî CSV –≤—ã–≥—Ä—É–∑–∫–∞
- `/sheet` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—â—É—é —Ç–∞–±–ª–∏—Ü—É (–µ—Å–ª–∏ `SHEET_URL` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)
- `/cancel` ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—à–∞–≥–æ–≤—ã–π –≤–≤–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä —Å–æ–±–µ—Å–æ–≤)

> –ü–µ—Ä–∏–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `month`.

## 0. –ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

- Node.js 18+ (–ª—É—á—à–µ 20)
- Git

## 1. –°–æ–∑–¥–∞–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub

1) –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π repo (–Ω–∞–ø—Ä–∏–º–µ—Ä `hh-tracker-worker`).
2) –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–π –ø–∞–ø–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
3) Commit ‚Üí push.

## 2. –°–æ–∑–¥–∞–π D1 –±–∞–∑—É –∏ –ø—Ä–∏–≤—è–∂–∏ –≤ `wrangler.toml`

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
npm i
npx wrangler login
npx wrangler d1 create hh-tracker-db
```

–ö–æ–º–∞–Ω–¥–∞ –≤–µ—Ä–Ω—ë—Ç `database_id`. –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ `wrangler.toml`:

```toml
[[d1_databases]]
binding = "DB"
database_name = "hh-tracker-db"
database_id = "PASTE_DATABASE_ID_HERE"
```

## 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
npx wrangler d1 migrations apply hh-tracker-db
```

## 4. –°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### BOT_TOKEN

–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ BotFather:

```bash
npx wrangler secret put BOT_TOKEN
```

### TELEGRAM_WEBHOOK_SECRET

–õ—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ **—Ç–æ–ª—å–∫–æ –∏–∑** `A-Z a-z 0-9 _ -`.

–ü—Ä–∏–º–µ—Ä (40 —Å–∏–º–≤–æ–ª–æ–≤):

```text
b7B7Cqk8d0mZcKQhT_2s5Lw1pR9kVn3aXy0uJ7sE
```

–ó–∞–¥–∞—Ç—å:

```bash
npx wrangler secret put TELEGRAM_WEBHOOK_SECRET
```

### SHEET_URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–º–∞–Ω–¥—É `/sheet` (—Å—Å—ã–ª–∫–∞ –æ–¥–Ω–∞ –¥–ª—è –≤—Å–µ—Ö):

```bash
npx wrangler secret put SHEET_URL
```

## 5. Deploy

```bash
npx wrangler deploy
```

–í –∫–æ–Ω—Ü–µ —É–≤–∏–¥–∏—à—å URL –≤–æ—Ä–∫–µ—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```text
https://hh-tracker-worker.<subdomain>.workers.dev
```

## 6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook Telegram

–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∏–ª–∏ curl):

```text
https://api.telegram.org/bot<–¢–û–ö–ï–ù>/setWebhook?url=<WORKER_URL>/telegram&secret_token=<WEBHOOK_SECRET>&drop_pending_updates=true
```

–ì–¥–µ:
- `<WORKER_URL>` ‚Äî URL –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ—Å–ª–µ deploy
- `/telegram` ‚Äî –ø—É—Ç—å –≤–µ–±—Ö—É–∫–∞ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ

–í–∞–∂–Ω–æ: `secret_token=<WEBHOOK_SECRET>` –≤ setWebhook –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å **1:1** —Å —Å–µ–∫—Ä–µ—Ç–æ–º `TELEGRAM_WEBHOOK_SECRET` –≤ Cloudflare. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥—ë—Ç ‚Äî –≤–æ—Ä–∫–µ—Ä –æ—Ç–≤–µ—Ç–∏—Ç 403, –∏ –±–æ—Ç –±—É–¥–µ—Ç ¬´–º–æ–ª—á–∞—Ç—å¬ª.

## 7. –ü—Ä–æ–≤–µ—Ä–∫–∞

1) –ù–∞–ø–∏—à–∏ –±–æ—Ç—É `/start`
2) –ù–∞–∂–º–∏ **‚ûï –ù–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç**
3) –í—Å—Ç–∞–≤—å –∫—É—Å–æ–∫ —Å–ø–∏—Å–∫–∞ –æ—Ç–∫–ª–∏–∫–æ–≤
4) –ù–∞–∂–º–∏ **‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–º–ø–æ—Ä—Ç**
5) –ù–∞–∂–º–∏ **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Üí **–ù–µ–¥–µ–ª—è**
6) –ù–∞–∂–º–∏ **üìà –û—Ç—á—ë—Ç** ‚Üí **–ù–µ–¥–µ–ª—è**
7) –ù–∞–∂–º–∏ **‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç CSV** ‚Üí **–ù–µ–¥–µ–ª—è**

## –ü—Ä–æ –≥—Ä–∞—Ñ–∏–∫–∏

–ì—Ä–∞—Ñ–∏–∫–∏ –≥–µ–Ω–µ—Ä—è—Ç—Å—è –±–µ–∑ Python ‚Äî —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å QuickChart (Chart.js), –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫–∏.
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–æ–º–ø–µ
- –±–æ—Ç —Å–∞–º –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ —á–∞—Ç

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É–±—Ä–∞—Ç—å –≤–Ω–µ—à–Ω—é—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é PNG –≤–Ω—É—Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞ (–Ω–µ –≤ Worker).
